!function(e,t,n){"use strict";if("function"!=typeof n)throw new Error("Medium Editor is not loaded on the page.");var i={name:"embedButton",action:"embedAction",contentDefault:"E",contentFA:'<i class="fa fa-youtube-play"></i>',aria:"Embed media",defaults:{msgSelectOnlyUrl:"Seçtiğiniz metin geçerli bir URL değil!",msgSelectOnlyEmbadableUrl:"Seçtiğiniz URL desteklenmiyor!",oembedProxy:"http://iframe.ly/api/oembed?api_key=APIKEY_HERE&url=",cssEmbedOverlay:"medium-editor-embeds-overlay",cssEmbeds:"medium-editor-embeds",cssSelected:"medium-editor-embeds-selected",instagramEmbedScript:"//platform.instagram.com/en_US/embeds.js",twitterEmbedScripts:"//platform.twitter.com/widgets.js",facebookEmbedScripts:"//connect.facebook.net/en_US/sdk.js",youtubeEmbedScripts:"",vimeoEmbedScripts:""},init:function(){n.extensions.button.prototype.init.call(this),this.opts=n.util.extend({},this.defaults,this.embedOpts);for(var e=this,t=e.document,i=t.querySelectorAll("."+e.opts.cssEmbeds),s=0;s<i.length;s++){var o=i[s];o.setAttribute("contenteditable",!1),null===o.querySelector("."+e.opts.cssEmbedOverlay)&&e.appendOverlay(o)}this.base._originalSerializerPreEmbeds=e.base.serialize,this.base.serialize=e.embedSerialize,this.attachEvents()},attachEvents:function(){this.on(this.document,"click",this.unselectEmbed.bind(this));var e=this.document.querySelectorAll("."+this.opts.cssEmbedOverlay);this.on(e,"click",this.selectEmbed.bind(this)),this.on(this.document,"keydown",this.removeEmbed.bind(this)),this.on(this.base.elements,"keydown",this.deleteEmbedOnBackspaceAndDel.bind(this))},ajaxGet:function(e,n,i){var s=new XMLHttpRequest;return s.onreadystatechange=function(){s.readyState===XMLHttpRequest.DONE&&(200===s.status?n.apply(s,[JSON.parse(s.responseText)]):400===s.status||"undefined"!=typeof i&&i.apply(s))},s.open("GET",e,!0),s.setRequestHeader("X-Requested-With","XMLHttpRequest"),s.setRequestHeader("Access-Control-Allow-Origin","*"),s.setRequestHeader("Referrer",t.location.href),s.send(),s},handleClick:function(e){e.preventDefault(),e.stopPropagation();var t=this,i=n.selection.getSelectionRange(t.document);if("a"===i.startContainer.nodeName.toLowerCase()||"a"===i.endContainer.nodeName.toLowerCase()||n.util.getClosestTag(n.selection.getSelectedParentElement(i),"a"))return t.execAction("unlink");if("#text"!==i.startContainer.nodeName.toLowerCase()&&"#text"!==i.endContainer.nodeName.toLowerCase())return alert(t.opts.msgSelectOnlyUrl),!1;var s=this.getSelection();return s.indexOf("http")<0?(alert(t.opts.msgSelectOnlyUrl),!1):(t.ajaxGet(t.opts.oembedProxy+s,function(e){t.insertEmbed(e)}),void t.base.checkContentChanged())},getSelection:function(){var n="";return e.getSelection?n=e.getSelection().toString():t.getSelection?n=t.getSelection().toString():t.selection&&(n=t.selection.createRange().text),n},appendOverlay:function(e){var t=this.document.createElement("div");t.className=this.opts.cssEmbedOverlay,e.appendChild(t)},insertEmbed:function(t){var i=this,s=n.util.guid(),o=i.document.createElement("div");if(o.setAttribute("id",s),o.setAttribute("contenteditable",!1),o.className=i.opts.cssEmbeds,o.innerHTML=t.html,i.appendOverlay(o),i.base.pasteHTML(i.getHtml(o),{cleanAttrs:[],cleanTags:[]}),this.on(i.document.getElementById(s),"click",this.selectEmbed.bind(this)),t.url.indexOf("instagr")>-1){if("undefined"==typeof e.instgrm)return void i.injectScript(i.opts.instagramEmbedScript);e.instgrm.Embeds.process()}else if(t.url.indexOf("facebook")>-1&&"undefined"!=typeof e.FB)setTimeout(function(){e.FB.XFBML.parse()},1500);else if(t.url.indexOf("twitter")>-1){if("undefined"==typeof e.twttr)return void i.injectScript(i.opts.twitterEmbedScripts);e.twttr.widgets.load()}},selectEmbed:function(e){e.preventDefault(),e.stopPropagation();var t=this,n=e.target,i=n.parentElement;if(!i.classList.contains(t.opts.cssSelected)){var s=t.document.querySelectorAll("."+t.opts.cssEmbeds);"undefined"!=typeof s&&null!==s&&s.forEach(function(e){e.classList.remove(t.opts.cssSelected)}),i.classList.add(t.opts.cssSelected)}},unselectEmbed:function(e){var t=this,n=e.target,i=t.document.querySelectorAll("."+t.opts.cssEmbeds);if(0===i.length)return!1;if(n.classList.contains(t.opts.cssEmbedOverlay))return!1;for(var s=0;s<i.length;s++){var o=i[s];o.classList.remove(t.opts.cssSelected)}},removeEmbed:function(e){var t,i=this;if(n.util.isKey(e,[n.util.keyCode.BACKSPACE,n.util.keyCode.DELETE])&&(t=i.document.querySelector("."+i.opts.cssSelected),null!==t)){e.preventDefault();var s=i.document.createElement("p");t.parentElement.insertBefore(s,t),t.parentElement.removeChild(t)}},deleteEmbedOnBackspaceAndDel:function(e){if(n.util.isKey(e,[n.util.keyCode.DELETE,n.util.keyCode.BACKSPACE])){var t=n.selection.getSelectionStart(this.base.options.ownerDocument),i=this,s=n.selection.getSelectionRange(i.document),o=n.util.getClosestTag(n.selection.getSelectedParentElement(s),"p"),r=n.selection.getCaretOffsets(t);if(!(r.left>0)){var a=o.previousSibling;if("undefined"!=typeof a&&"undefined"!=typeof a.classList&&a.classList.contains(i.opts.cssEmbeds)){e.preventDefault(),e.stopPropagation();var l=i.document.createElement("p");a.parentElement.insertBefore(l,a),a.parentElement.removeChild(a)}}}},embedSerialize:function(){var e=this,t=e._originalSerializerPreEmbeds(),n=e.options.ownerDocument,i=e.getExtensionByName("embedButton");for(var s in t)if(t.hasOwnProperty(s)){var o=t[s],r=n.createElement("div");r.innerHTML=o.value;var a=r.querySelectorAll("."+i.opts.cssEmbeds);null!==a&&a.forEach(function(e){e.removeAttribute("contenteditable"),e.classList.remove(i.opts.cssSelected);var t=e.querySelector("."+i.opts.cssEmbedOverlay);null!==t&&t.parentElement.removeChild(t)}),t[s].value=r.innerHTML}return t},getHtml:function(e){var t=this.document.createElement("div");return t.appendChild(e.cloneNode(!0)),t.innerHTML},injectScript:function(e){var t=this.document.createElement("script");t.type="text/javascript",t.async=!0,t.onLoad=function(){},t.src=this.document.location.protocol+e,this.document.getElementsByTagName("head")[0].appendChild(t)}};e.EmbedButtonExtension=n.extensions.button.extend(i)}(window,document,MediumEditor);