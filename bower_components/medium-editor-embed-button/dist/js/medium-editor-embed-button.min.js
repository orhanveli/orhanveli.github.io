!function(e,t,s){"use strict";function n(e){if(e&&"FORM"===e.nodeName){var t,s={};return Array.prototype.slice.call(e.elements).forEach(function(e){if(""!==e.name)switch(e.nodeName){case"INPUT":switch(e.type){case"text":case"hidden":case"password":case"button":case"reset":case"submit":s[e.name]=e.value;break;case"checkbox":case"radio":e.checked&&(s[e.name]=e.value)}break;case"file":break;case"TEXTAREA":s[e.name]=e.value;break;case"SELECT":switch(e.type){case"select-one":s[e.name]=e.value;break;case"select-multiple":var n=[];for(t=e.options.length-1;t>=0;t-=1)e.options[t].selected&&n.push(e.options[t].value);s[e.name]=n}break;case"BUTTON":switch(e.type){case"reset":case"submit":case"button":s[e.name]=e.value}}}),s}}function o(e,t){for(var s,n,o=/<%(.+?)%>/g,i=/(^( )?(var|if|for|else|switch|case|break|{|}|;))(.*)?/g,a="with(obj) { var r=[];\n",r=0,d=function(e,t){return a+=t?e.match(i)?e+"\n":"r.push("+e+");\n":""!=e?'r.push("'+e.replace(/"/g,'\\"')+'");\n':"",d};n=o.exec(e);)d(e.slice(r,n.index))(n[1],!0),r=n.index+n[0].length;d(e.substr(r,e.length-r)),a=(a+'return r.join(""); }').replace(/[\r\t\n]/g," ");try{s=new Function("obj",a).apply(t,[t])}catch(e){console.error("'"+e.message+"'"," in \n\nCode:\n",a,"\n")}return s}function i(e){return e.replace(/([A-Z])/g,function(e){return"-"+e.toLowerCase()})}function a(e,t,s){function n(t,s){return r.set(e,t,s),a}function o(t){return r.del(e,t),a}function i(t){return r.get(e,t)}var a={set:n,get:i,del:o};return 3===arguments.length?n(t,s):2==arguments.length?i(t):a}var r;if(r="undefined"!=typeof t&&t.head&&t.head.dataset?{set:function(e,t,s){e.dataset[t]=s},get:function(e,t){return e.dataset[t]},del:function(e,t){delete e.dataset[t]}}:{set:function(e,t,s){e.setAttribute("data-"+i(t),s)},get:function(e,t){return e.getAttribute("data-"+i(t))},del:function(e,t){e.removeAttribute("data-"+i(t))}},"function"!=typeof s)throw new Error("Medium Editor is not loaded on the page.");var d={name:"embedButton",action:"embedAction",contentDefault:"E",contentFA:'<i class="fa fa-youtube-play"></i>',aria:"Embed media",defaults:{msgSelectOnlyUrl:"Selected text is not a valid URL!",msgSelectOnlyEmbadableUrl:"Selected URL is not supported!",msgMakeItVideoEmbed:"Embed video",msgTwitterEmbedModalTitle:"Twitter Embed Options",msgHideTweetStatusMessage:"Hide tweet text",msgInsertEmbed:"Embed ekle",oembedProxy:"http://iframe.ly/api/oembed?api_key=APIKEY_HERE&url=",cssEmbedOverlay:"medium-editor-embeds-overlay",cssEmbeds:"medium-editor-embeds",cssSelected:"medium-editor-embeds-selected",cssEmbedModal:"medium-editor-embeds__modal",instagramEmbedScript:"//platform.instagram.com/en_US/embeds.js",twitterEmbedScripts:"//platform.twitter.com/widgets.js",facebookEmbedScripts:"//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.7",iframelyEmbedScript:"//cdn.iframe.ly/embed.js",vimeoEmbedScripts:""},init:function(){s.extensions.button.prototype.init.call(this),this.opts=s.util.extend({},this.defaults,this.embedOpts);var e=this,t=e.document,n=t.querySelectorAll("."+e.opts.cssEmbeds);if(this.base._originalSerializerPreEmbeds=e.base.serialize,this.base.serialize=e.embedSerialize,this.base.embedModal=null,this.attachEvents(),"undefined"!=typeof n&&null!==n&&0!==n.length){for(var o=[],i=0;i<e.base.elements.length;i++){var a=e.base.elements[i],r=a.querySelectorAll("."+e.opts.cssEmbeds);o=o.concat(Array.prototype.slice.call(r))}for(var i=0;i<o.length;i++){var d=o[i];d.setAttribute("contenteditable",!1),null===d.querySelector("."+e.opts.cssEmbedOverlay)&&e.appendOverlay(d)}}},attachEvents:function(){this.on(this.document,"click",this.unselectEmbed.bind(this));var e=this.document.querySelectorAll("."+this.opts.cssEmbeds);this.on(e,"click",this.selectEmbed.bind(this)),this.on(this.document,"keydown",this.removeEmbed.bind(this)),this.on(this.base.elements,"keydown",this.deleteEmbedOnBackspaceAndDel.bind(this))},ajaxGet:function(e,s,n){var o=new XMLHttpRequest;return o.onreadystatechange=function(){o.readyState===XMLHttpRequest.DONE&&(200===o.status?s.apply(o,[JSON.parse(o.responseText)]):400===o.status||"undefined"!=typeof n&&n.apply(o))},o.open("GET",e,!0),o.setRequestHeader("X-Requested-With","XMLHttpRequest"),o.setRequestHeader("Access-Control-Allow-Origin","*"),o.setRequestHeader("Referrer",t.location.href),o.send(),o},handleClick:function(e){e.preventDefault(),e.stopPropagation();var t=this,n={},o=s.selection.getSelectionRange(t.document);if("a"===o.startContainer.nodeName.toLowerCase()||"a"===o.endContainer.nodeName.toLowerCase()||s.util.getClosestTag(s.selection.getSelectedParentElement(o),"a"))return t.execAction("unlink");if("#text"!==o.startContainer.nodeName.toLowerCase()&&"#text"!==o.endContainer.nodeName.toLowerCase())return alert(t.opts.msgSelectOnlyUrl),!1;var i=this.getSelection();return t.base.saveSelection(),i.indexOf("http:")<0&&i.indexOf("https:")<0?(alert(t.opts.msgSelectOnlyUrl),!1):(n.selectedText=i,i.indexOf("twitter")>-1?(n.embedSource="twitter",void t.openEmbedModal(n)):(i.indexOf("youtube")>-1?n.embedSource="youtube":i.indexOf("instagram")>-1&&(n.embedSource="instagram"),void t.getAjaxResultAndPaste(o,n)))},openEmbedModal:function(e){var t=this,s=t.document,n=s.createElement("div"),i='<div class="<%cssEmbedModal%>"><div class="<%cssEmbedModalInner%>"><a href="" class="<%cssEmbedModalClose%>">&times;</a><div class="<%cssEmbedModalHeader%>"><h2><%msgTwitterEmbedModalTitle%></h2></div><div class="<%cssEmbedModalBody%>"><form class="<%cssEmbedModalForm%>"><input type="hidden" name="selectedText" value="<%selectedText%>" /><input type="hidden" name="embedSource" value="<%embedSource%>" />';switch(e.embedSource){case"twitter":i+='<p><label><input type="checkbox" name="tweetAsVideo" value="true" /> <%msgMakeItVideoEmbed%></label></p><p><label>'}i+='</form></div><div class="<%cssEmbedModalFooter%>"><button class="<%cssEmbedModal%>-submit"><%msgInsertEmbed%></button></div></div></div>';var a=o(i,{cssEmbedModal:t.opts.cssEmbedModal,cssEmbedModalInner:t.opts.cssEmbedModal+"-inner",cssEmbedModalClose:t.opts.cssEmbedModal+"-close",cssEmbedModalHeader:t.opts.cssEmbedModal+"-header",cssEmbedModalBody:t.opts.cssEmbedModal+"-body",cssEmbedModalForm:t.opts.cssEmbedModal+"-form",cssEmbedModalFooter:t.opts.cssEmbedModal+"-footer",selectedText:e.selectedText,embedSource:e.embedSource,msgMakeItVideoEmbed:t.opts.msgMakeItVideoEmbed,msgTwitterEmbedModalTitle:t.opts.msgTwitterEmbedModalTitle,msgInsertEmbed:t.opts.msgInsertEmbed,msgHideTweetStatusMessage:t.opts.msgHideTweetStatusMessage});n.innerHTML=a,this.base.embedModal=n,s.body.appendChild(n);var r=n.querySelector("."+t.opts.cssEmbedModal+"-close"),d=n.querySelector("."+t.opts.cssEmbedModal+"-submit");this.on(r,"click",this.closeAndDestroyModal.bind(this)),this.on(d,"click",this.submitEmbedModal.bind(this))},closeAndDestroyModal:function(e){e.preventDefault();var t=this,s=t.document,n=s.querySelector("."+t.opts.cssEmbedModal);this.base.embedModal=null,void 0!==n&&n.parentNode.removeChild(n)},submitEmbedModal:function(e){e.preventDefault();var t=this,o=t.document,i=o.querySelector("."+t.opts.cssEmbedModal),a=i.querySelector("form"),r=s.selection.getSelectionRange(t.document),d=n(a);t.getAjaxResultAndPaste(r,d),t.closeAndDestroyModal(e)},getSelection:function(){var s="";return e.getSelection?s=e.getSelection().toString():t.getSelection?s=t.getSelection().toString():t.selection&&(s=t.selection.createRange().text),s},appendOverlay:function(e){var t=this.document.createElement("div");t.className=this.opts.cssEmbedOverlay,e.appendChild(t)},getAjaxResultAndPaste:function(e,t){var s=this,n=s.opts.oembedProxy+t.selectedText;s.base.restoreSelection(),s.ajaxGet(n,function(n){e.deleteContents(),n.url=t.selectedText,s.insertEmbed(e,n,t)})},insertEmbed:function(e,t,n){var o=this,i=s.util.guid(),r=o.document.createElement("div");if(r.setAttribute("id",i),r.setAttribute("contenteditable",!1),"undefined"!=typeof n&&"twitter"===n.embedSource&&"true"===n.tweetAsVideo){var d=o.document.createElement("div");d.innerHTML=t.html;var l=d.querySelector("blockquote");l.classList.remove("twitter-tweet"),l.classList.add("twitter-video"),"undefined"!=typeof n.hideStatus&&"true"===n.hideStatus?a(l,"status","hidden"):a(l,"status","show"),t.html=l.outerHTML}a(r,"originalResponse",JSON.stringify(t)),r.className=o.opts.cssEmbeds,r.innerHTML=t.html,o.appendOverlay(r),o.base.pasteHTML(o.getHtml(r),{cleanAttrs:[],cleanTags:[]});var c=o.document.getElementById(i);if(null!==c){var m=c.querySelector("."+o.opts.cssEmbedOverlay);this.on(m,"click",this.selectEmbed.bind(this))}o.base.checkContentChanged(),o.parseSiteSpecific(t)},loadIfIframely:function(){"undefined"!=typeof this.opts.oembedProxy&&this.opts.oembedProxy.indexOf("iframely")&&this.injectScript(this.opts.iframelyEmbedScript)},parseSiteSpecific:function(t){var s=this;if(t.url.indexOf("instagr")>-1){if("undefined"==typeof e.instgrm)return void s.injectScript(s.opts.instagramEmbedScript);e.instgrm.Embeds.process()}else if(t.url.indexOf("twitter")>-1){if("undefined"==typeof e.twttr)return void s.injectScript(s.opts.twitterEmbedScripts);e.twttr.widgets.load()}else s.loadIfIframely()},selectEmbed:function(e){e.preventDefault(),e.stopPropagation();var t=this,s=e.target,n=s.parentElement;if(!n.classList.contains(t.opts.cssSelected)){var o=t.document.querySelectorAll("."+t.opts.cssEmbeds);"undefined"!=typeof o&&null!==o&&o.forEach(function(e){e.classList.remove(t.opts.cssSelected)}),n.classList.add(t.opts.cssSelected)}},unselectEmbed:function(e){var t=this,s=e.target,n=t.document.querySelectorAll("."+t.opts.cssEmbeds);if("undefined"!=typeof n&&null!==n&&0!==n.length&&!s.classList.contains(t.opts.cssEmbedOverlay))for(var o=0;o<n.length;o++){var i=n[o];i.classList.remove(t.opts.cssSelected)}},removeEmbed:function(e){var t,n=this;if(s.util.isKey(e,[s.util.keyCode.BACKSPACE,s.util.keyCode.DELETE])&&(t=n.document.querySelector("."+n.opts.cssSelected),null!==t)){e.preventDefault();var o=n.document.createElement("p");t.parentElement.insertBefore(o,t),t.parentElement.removeChild(t)}},deleteEmbedOnBackspaceAndDel:function(e){if(s.util.isKey(e,[s.util.keyCode.DELETE,s.util.keyCode.BACKSPACE])){var t=s.selection.getSelectionStart(this.base.options.ownerDocument),n=this,o=s.selection.getSelectionRange(n.document),i=s.util.getClosestTag(s.selection.getSelectedParentElement(o),"p"),a=s.selection.getCaretOffsets(t);if(!(a.left>0)){var r=i.previousSibling;if("undefined"!=typeof r&&"undefined"!=typeof r.classList&&r.classList.contains(n.opts.cssEmbeds)){e.preventDefault(),e.stopPropagation();var d=n.document.createElement("p");r.parentElement.insertBefore(d,r),r.parentElement.removeChild(r)}}}},embedSerialize:function(){var e=this,t=e._originalSerializerPreEmbeds(),s=e.options.ownerDocument,n=e.getExtensionByName("embedButton");for(var o in t)if(t.hasOwnProperty(o)){var i=t[o],r=s.createElement("div");r.innerHTML=i.value;var d=r.querySelectorAll("."+n.opts.cssEmbeds);if("undefined"!=typeof d&&null!==d&&d.length>0)for(var l=0;l<d.length;l++){var c=d[l],m=a(c,"originalResponse");if(m&&null!==m){var u=JSON.parse(m);c.innerHTML=u.html;var p={html:u.html,url:u.url};a(c).set("originalResponse",JSON.stringify(p))}else{var b=c.querySelector("."+n.opts.cssEmbedOverlay);null!==b&&b.parentElement.removeChild(b)}c.removeAttribute("contenteditable"),c.classList.remove(n.opts.cssSelected)}t[o].value=r.innerHTML}return t},getHtml:function(e){var t=this.document.createElement("div");return t.appendChild(e.cloneNode(!0)),t.innerHTML},injectScript:function(e){var t=this.document.createElement("script");t.type="text/javascript",t.async=!0,t.onLoad=function(){},t.src=this.document.location.protocol+e,this.document.getElementsByTagName("head")[0].appendChild(t)}},l=s.extensions.button.extend(d);"undefined"!=typeof module&&"undefined"!=typeof module.exports?module.exports=l:"function"==typeof define&&define.amd?define([],function(){return l}):e.EmbedButtonExtension=l}(window,document,MediumEditor);
//# sourceMappingURL=medium-editor-embed-button.js.map
